<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Registro Profesional - Tecno Chiguires</title>
  <link rel="icon" type="image/png" href="img/logo.png">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { 
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
    }
    .container-form {
      background: rgba(255,255,255,0.95);
      padding: 40px;
      border-radius: 20px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.1);
      backdrop-filter: blur(10px);
      max-width: 900px;
      margin: 40px auto;
    }
    .form-control:focus {
      border-color: #007bff;
      box-shadow: 0 0 0 0.2rem rgba(0,123,255,0.25);
    }
  </style>
</head>
<body>

<!-- Header -->
<nav class="navbar navbar-expand-lg navbar-dark bg-primary shadow">
  <div class="container">
    <a class="navbar-brand fw-bold fs-3" href="index.html">Tecno Chiguires</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navMenu">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navMenu">
<ul class="navbar-nav ms-auto">
        <li class="nav-item"><a class="nav-link fw-semibold" href="index.html">üè† Inicio</a></li>
        <li class="nav-item"><a class="nav-link fw-semibold" href="portafolio.html">üíº Portafolio</a></li>
        <li class="nav-item"><a class="nav-link fw-semibold" href="sobre_nosotros.html">üë• Sobre Nosotros</a></li>
        <li class="nav-item">
          <button id="authBtn" class="btn btn-warning fw-semibold ms-md-3">Registro/Inicio Sesi√≥n</button>
        </li>
      </ul>
    </div>
  </div>
</nav>

<div class="container-form">
  <div class="text-center mb-4">
    <img src="img/chiguireestudiante.png" alt="Chigure Estudiante" class="rounded-circle mb-3" width="100" height="100" style="object-fit: cover;">
    <h2 class="text-primary">Registro</h2>
    <p class="text-muted">√önete al equipo de chiguires de UNETI</p>
  </div>

  <!-- Alert for messages -->
  <div id="alertContainer"></div>

  <form id="registroForm" novalidate class="needs-validation">
    <!-- Authentication Section -->
    <div class="mb-4">
      <h4 class="mb-3 text-primary">Datos de Acceso</h4>
      <div class="row g-3">
        <div class="col-md-6">
          <label for="email" class="form-label fw-semibold">Correo electr√≥nico</label>
          <input type="email" class="form-control form-control-lg" id="email" name="email" 
                 required placeholder="correo@ejemplo.com" />
          <div class="invalid-feedback">Ingrese un correo electr√≥nico v√°lido.</div>
        </div>
        <div class="col-md-6">
          <label for="password" class="form-label fw-semibold">Contrase√±a</label>
          <input type="password" class="form-control form-control-lg" id="password" name="password" 
                 required minlength="6" placeholder="M√≠nimo 6 caracteres" />
          <div class="invalid-feedback">La contrase√±a debe tener al menos 6 caracteres.</div>
        </div>
      </div>
    </div>

    <!-- Form fields same as before -->
    <div class="mb-4">
      <h4 class="mb-3 text-primary">Datos del Profesional</h4>
      <div class="row g-3">
        <div class="col-md-6">
          <label for="nombre" class="form-label fw-semibold">Nombres y Apellidos completos</label>
          <input type="text" class="form-control form-control-lg" id="nombre" name="nombre" 
                 required pattern="^[A-Za-z√Å√â√ç√ì√ö√°√©√≠√≥√∫√ë√±\s]{3,}$" placeholder="Ej: Juan P√©rez" />
          <div class="invalid-feedback">Ingrese un nombre v√°lido (solo letras, m√≠nimo 3 caracteres).</div>
        </div>
        <div class="col-md-6">
          <label for="telefono" class="form-label fw-semibold">Tel√©fono (opcional)</label>
          <input type="tel" class="form-control form-control-lg" id="telefono" name="telefono" 
                 placeholder="Ej: +58 414 123 4567" />
        </div>
      </div>
    </div>

    <div class="mb-4">
      <h4 class="mb-3 text-primary">Informaci√≥n T√©cnica</h4>
      <div class="row g-3">
        <div class="col-md-6">
          <label for="especialidad" class="form-label fw-semibold">Especialidad T√©cnica</label>
          <select class="form-select form-select-lg" id="especialidad" name="especialidad" required>
            <option value="">Seleccione su especialidad...</option>
            <option value="electronica">Electr√≥nica y Telecomunicaciones</option>
            <option value="informatica">Inform√°tica y Sistemas</option>
            <option value="redes">Redes y Comunicaciones</option>
            <option value="mantenimiento">Mantenimiento de Equipos</option>
            <option value="soporte">Soporte T√©cnico General</option>
          </select>
          <div class="invalid-feedback">Seleccione una especialidad t√©cnica.</div>
        </div>
        <div class="col-md-6">
          <label for="experiencia" class="form-label fw-semibold">A√±os de experiencia</label>
          <input type="number" class="form-control form-control-lg" id="experiencia" 
                 name="experiencia" min="0" max="50" required placeholder="Ej: 2" />
          <div class="invalid-feedback">Ingrese un n√∫mero v√°lido entre 0 y 50.</div>
        </div>
      </div>
    </div>

    <div class="mb-4">
      <label for="mensaje" class="form-label fw-semibold">Comentarios adicionales</label>
      <textarea class="form-control" id="mensaje" name="mensaje" rows="4" 
                maxlength="500" placeholder="Cu√©ntanos sobre tus habilidades t√©cnicas, proyectos realizados o √°reas de inter√©s..."></textarea>
      <div class="form-text">M√°ximo 500 caracteres</div>
    </div>

    <div class="mb-4 form-check">
      <input type="checkbox" class="form-check-input" id="terminos" required />
      <label class="form-check-label fw-semibold" for="terminos">
        Acepto formar parte del equipo Tecno Chiguires.
      </label>
      <div class="invalid-feedback">Debe aceptar los t√©rminos para continuar.</div>
    </div>

    <div class="d-grid">
      <button type="submit" class="btn btn-primary btn-lg py-3" id="submitBtn">
        <span id="btnText">Crear Cuenta</span>
        <span id="btnSpinner" class="spinner-border spinner-border-sm ms-2 d-none"></span>
      </button>
    </div>
  </form>

  <div class="text-center mt-4">
    <p class="text-muted">¬øYa tienes una cuenta? <a href="login.html" class="text-primary">Inicia sesi√≥n aqu√≠</a></p>
  </div>

  <div class="text-center mt-4">
    <img src="img/chiguireinicio.jpg" alt="Equipo de Chiguires" class="rounded" width="200" height="120" style="object-fit: cover;">
  </div>
</div>

<!-- Footer -->
<footer class="bg-dark text-light mt-5">
  <div class="container py-4">
    <div class="row">
      <div class="col-md-6">
        <h5 class="text-warning">ü¶¶ Tecno Chiguires</h5>
        <p class="mb-2">Estudiantes de PNF INFORM√ÅTICA</p>
        <p class="mb-0">Universidad Nacional Experimental de Telecomunicaciones e Inform√°tica (UNETI)</p>
      </div>
      <div class="col-md-6 text-md-end">
        <h6 class="text-warning">Desarrolladores:</h6>
        <p class="mb-1">Roiner Martinez &middot; Benjamin Dumont</p>
        <p class="mb-1">Mariangel Ortiz &middot; Laura Linares</p>
        <small class="text-warning">&copy; 2025 Tecno Chiguires. Proyecto Programaci√≥n.</small>
      </div>
    </div>
  </div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<!-- Firebase Scripts -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";
  import { getAuth, createUserWithEmailAndPassword, updateProfile, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-auth.js";
  import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js";

  // Firebase configuration
  const firebaseConfig = {
    apiKey: "AIzaSyAUWnr84FZaFOsfD59JxEfl_RUXYq-1vec",
    authDomain: "tecnochiguires.firebaseapp.com",
    projectId: "tecnochiguires",
    storageBucket: "tecnochiguires.firebasestorage.app",
    messagingSenderId: "519894458196",
    appId: "1:519894458196:web:7ae20e53096cc248dfb2c1",
    measurementId: "G-3CLH3104V3"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  // Make Firebase functions available globally (if needed by other scripts, otherwise remove)
  window.auth = auth;
  window.db = db;
  window.createUserWithEmailAndPassword = createUserWithEmailAndPassword;
  window.updateProfile = updateProfile;
  window.doc = doc;
  window.setDoc = setDoc;

  // Auth button logic
  document.addEventListener('DOMContentLoaded', function() {
    const authBtn = document.getElementById('authBtn');
    if (authBtn) {
      authBtn.addEventListener('click', () => {
        onAuthStateChanged(auth, (user) => {
          if (user) {
            // User is signed in, redirect to user dashboard
            window.location.href = 'usuario.html';
          } else {
            // No user is signed in, redirect to registration
            window.location.href = 'formulario.html';
          }
        });
      });
    }
  });
</script>

<script>
document.getElementById('registroForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const form = this;
    const submitBtn = document.getElementById('submitBtn');
    const btnText = document.getElementById('btnText');
    const btnSpinner = document.getElementById('btnSpinner');
    const alertContainer = document.getElementById('alertContainer');
    
    // Show loading state
    submitBtn.disabled = true;
    btnText.textContent = 'Creando cuenta...';
    btnSpinner.classList.remove('d-none');
    
    // Clear previous alerts
    alertContainer.innerHTML = '';
    
    // Get form data
    const formData = new FormData(form);
    const data = Object.fromEntries(formData.entries());
    
    try {
        // Create user with Firebase Auth
        const userCredential = await window.createUserWithEmailAndPassword(
            window.auth, 
            data.email, 
            data.password
        );
        
        const user = userCredential.user;
        
        // Update user profile with display name
        await window.updateProfile(user, {
            displayName: data.nombre
        });
        
        // Save additional user data to Firestore
        await window.setDoc(window.doc(window.db, 'usuarios', user.uid), {
            nombre: data.nombre,
            email: data.email,
            telefono: data.telefono || '',
            especialidad: data.especialidad,
            experiencia: parseInt(data.experiencia),
            mensaje: data.mensaje || '',
            fechaRegistro: new Date().toISOString(),
            uid: user.uid
        });
        
        // Show success message
        alertContainer.innerHTML = `
            <div class="alert alert-success alert-dismissible fade show" role="alert">
                <strong>‚úÖ ¬°√âxito!</strong> Tu cuenta ha sido creada exitosamente.
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
        `;
        
        // Redirect after 2 seconds
        setTimeout(() => {
            window.location.href = `gracias.html?nombre=${encodeURIComponent(data.nombre)}`;
        }, 2000);
        
    } catch (error) {
        let errorMessage = 'Error desconocido';
        
        // Handle specific Firebase errors
        switch (error.code) {
            case 'auth/email-already-in-use':
                errorMessage = 'Este correo electr√≥nico ya est√° registrado';
                break;
            case 'auth/invalid-email':
                errorMessage = 'Correo electr√≥nico inv√°lido';
                break;
            case 'auth/weak-password':
                errorMessage = 'La contrase√±a es muy d√©bil';
                break;
            case 'auth/network-request-failed':
                errorMessage = 'Error de conexi√≥n. Verifica tu internet.';
                break;
            default:
                errorMessage = error.message;
        }
        
        alertContainer.innerHTML = `
            <div class="alert alert-danger alert-dismissible fade show" role="alert">
                <strong>‚ùå Error:</strong> ${errorMessage}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
        `;
    } finally {
        // Reset button state
        submitBtn.disabled = false;
        btnText.textContent = 'Crear Cuenta';
        btnSpinner.classList.add('d-none');
    }
});
</script>
</body>
</html>
